<?php
//this is an api to get friends 

// +-----------------------------------+
// + STEP 1: include required files    +
// +-----------------------------------+
require_once("../php_include/db_connection.php");
require_once("DataClass.php");
$success=$msg="0";$data=array();
// +-----------------------------------+
// + STEP 2: get data				   +
// +-----------------------------------+
error_reporting(0);


/*$cont=json_encode($contacts);

$sql="insert into test values(DEFAULT,:json)";
$sth=$conn->prepare($sql);
$sth->bindValue('json',$cont);
try{$sth->execute();}
catch(Exception $e){echo $e->getMessage();}
*/

$dict=array();
//$contacts=["9888146140","+918284988569","+919872014078","9876798229","8872156027","9855900341","+917508268922","9888444785","9855628530","9888195950","+918146511992","9592553437","9779863559","8439771413","8054269911","1800MYAPPLE","9855672599","8872060730","+919872132977","9814759070","8146212407","1676279517","+919417183813","9888583307","+919815182486","8283839188","987812419","+919914822289","9463912455","8146391016","8968519929","9464871600","9888223756","+919041032317","163513","9815833631","9781796145","9914340087","+919815750101","9646173556","+918427673396","9781613150","+919779000911","9878137004","7696808674","+919878088832","9914244222","9417706643","16985518","9914337003","9815113333","+919878800100","9780002383","9803090724","977944839","+919592939977","+919592939977","9878700028","+918284898780","+918699002000","9317100007","+919914900059","9592400341","+918427997531","8427528428","9780653001","8146651521","9855431131","+919876849703","+16478253131","9592200556","9781687861","+919478485863","9872167020","9876331519","+919501147547","+919815153942","8054977914","8936961","9888005591","9876669080","161232773","9815629013","9872800460","7355547333","8054098981","+919915767280","+919803218885","+919803180056","7837712716","+919872666688","9878380260","9876426195","9592506400","7837006968","+911726537494","+919876317769","+4035601506","805428457","9878540641","9878290499","9815464105","+0012897522386","+12897525114","+919501293661","9815095351","7696363961","9872439921","+919988188670","+919646500899","9646383829","8527574137","9876707049","+919876323426","9888322331","9216456341","9780899530","9814156341","9815489243","8054771224","9888828566","9878222366","9815785176","8557984748","9501485800","+918146913807","+919501580004","7837319546","9855409977","9872951862","9041882710","+918558880175","9888821021","951811","9592912456","9988852513","9815255161","9779700297","8054849086","9888898024","+919096433258","17552333","9855685175","+919463794964","9888318444","+918437404059","9988213285","+918195922884","9914468985","+919041737183","9780665115","+919805306206","9478581876","8968086997","9803964907","+2897522386","+919988128025","9915920120","9501600990","9988685419","9872277465","+919781469555","9464544435","+919561485006","9888647615","9815087383","+917696745526","9592500097","9915549260","+917355667029","+918557037282","9736979587","8968102841","8968944304","+918289036634","8146842982","+918288002908","7837535603","9779209691","7837431620","9041134419","+918146905791","9996202820","7696358117","9816994422","9878806479","8427386512","+919888636071","8146651543","+918284835006","+919815995195","9914256007","9915545625","1425220420"];


//$contacts=[  "1425220420","1123456789" ];
$tnt=DataClass::get_all_contacts();

$db_count=sizeof($tnt);
$cont_count=sizeof($contacts);


/*for($i=0;$i<$db_count;$i++){
for($j=0;$j<$cont_count;$j++){

$a= substr_compare($i['phone_number'],$contacts[$j],-10,10);
if($a==0){
$dict[]=$contacts[$j];
}
}
}*/

foreach($tnt as $r){
foreach($contacts as $row){

$a= substr_compare($r['phone_number'],$row,-10,10);
if($a==0){
$dict[]=$row;
}
}
}

print_r($dict);


die;

$contacts=$_REQUEST['contacts'];
$token=$_REQUEST['token'];

if(!($contacts && $token)){
	$success="0";
	$msg="Incomplete Parameters";
	$data=array();
}
else{

	$sql="select * from users where verification_code=:token and is_deleted=0";
	$sth=$conn->prepare($sql);
	$sth->bindValue('token',$token);
	try{$sth->execute();}
	catch(Exception $e){
	echo $e->getMessage();
	}
	$res=$sth->fetchAll();
	$uid=$res[0]['id'];
	
	if(count($res)){
	
	$tnt=DataClass::get_friends($contacts,$uid);
	$data['profile']=$tnt?$tnt:[];
	
	if($data){
	$success=1;
	$msg="Profile Active";
	}
	else{
	$success=0;
	$msg="No Records Found";
	}
	}
	else{
	$success=0;
	$msg="Invalid User";
	}
	

}
// +-----------------------------------+
// + STEP 4: send json data			   +
// +-----------------------------------+
if($success==1){
echo json_encode(array("success"=>$success,"msg"=>$msg,"data"=>$data));
}
else
echo json_encode(array("success"=>$success,"msg"=>$msg));
?>